<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fallback机制演示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a8a;
        }
        .broken-button {
            background: #dc3545;
        }
        .broken-button:hover {
            background: #c82333;
        }
        .test-image {
            max-width: 200px;
            height: auto;
            margin: 10px;
            border: 2px solid #ddd;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🛡️ Fallback机制演示</h1>
        
        <div class="test-section">
            <h2>📋 测试说明</h2>
            <p>这个页面用于测试资源加载失败时的fallback机制。</p>
            <p>点击下面的按钮来模拟不同的加载场景。</p>
        </div>
        
        <div class="test-section">
            <h2>🔧 测试控制</h2>
            <button class="test-button" onclick="testNormalLoading()">测试正常加载</button>
            <button class="test-button broken-button" onclick="testBrokenCDN()">模拟CDN失败</button>
            <button class="test-button" onclick="testLocalFallback()">切换到本地资源</button>
            <button class="test-button" onclick="resetTest()">重置测试</button>
        </div>
        
        <div class="test-section">
            <h2>📊 测试结果</h2>
            <div id="test-status" class="status">准备就绪</div>
            <div id="test-images">
                <!-- 测试图片将在这里显示 -->
            </div>
        </div>
        
        <div class="test-section">
            <h2>📝 日志记录</h2>
            <pre id="test-log" style="background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script>
        const testLog = document.getElementById('test-log');
        const testStatus = document.getElementById('test-status');
        const testImages = document.getElementById('test-images');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog.textContent += `[${timestamp}] ${message}\n`;
            testLog.scrollTop = testLog.scrollHeight;
        }
        
        function updateStatus(message, type = 'success') {
            testStatus.textContent = message;
            testStatus.className = `status ${type}`;
        }
        
        function testNormalLoading() {
            log('开始测试正常加载...');
            updateStatus('测试正常加载', 'success');
            
            // 清空测试区域
            testImages.innerHTML = '';
            
            // 添加一些测试图片
            const testUrls = [
                'https://i.ibb.co/YdKVQ5j/tttslogo.png',
                'https://i.ibb.co/FBtN4PR/background111.jpg'
            ];
            
            testUrls.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url;
                img.className = 'test-image';
                img.onload = () => log(`图片 ${index + 1} 加载成功: ${url}`);
                img.onerror = () => log(`图片 ${index + 1} 加载失败: ${url}`);
                testImages.appendChild(img);
            });
        }
        
        function testBrokenCDN() {
            log('开始测试CDN失败...');
            updateStatus('模拟CDN失败', 'error');
            
            // 清空测试区域
            testImages.innerHTML = '';
            
            // 添加一些无效的CDN链接
            const brokenUrls = [
                'https://broken-cdn.example.com/image1.jpg',
                'https://invalid-host.com/image2.jpg'
            ];
            
            brokenUrls.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url;
                img.className = 'test-image';
                img.onload = () => log(`图片 ${index + 1} 加载成功: ${url}`);
                img.onerror = () => {
                    log(`图片 ${index + 1} 加载失败: ${url}`);
                    // 模拟fallback
                    const fallbackUrl = `assets/images/logo/logo${index + 1}.png`;
                    img.src = fallbackUrl;
                    img.style.border = '2px dashed #ff9800';
                    log(`图片 ${index + 1} 切换到fallback: ${fallbackUrl}`);
                };
                testImages.appendChild(img);
            });
        }
        
        function testLocalFallback() {
            log('开始测试本地资源...');
            updateStatus('测试本地资源', 'warning');
            
            // 如果存在全局的switchToLocalResources函数，调用它
            if (typeof switchToLocalResources === 'function') {
                switchToLocalResources();
                log('调用全局fallback函数');
            } else {
                log('未找到全局fallback函数');
            }
        }
        
        function resetTest() {
            log('重置测试...');
            updateStatus('准备就绪', 'success');
            testImages.innerHTML = '';
            log('测试已重置');
        }
        
        // 初始化
        window.onload = function() {
            log('Fallback机制演示页面已加载');
            updateStatus('页面已加载，准备测试', 'success');
        };
    </script>
</body>
</html>